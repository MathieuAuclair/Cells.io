<!DOCTYPE html>
<html onmousemove="mousePosition(event)">
	<head>
		<title>Cells.io</title>
		<meta charset="utf-8"/>
		<script src="/socket.io/socket.io.js"></script>
	</head>
	<body>
		<center>
			<canvas style="border:1px solid black;" width="500" height="500" id="canvas"></canvas>
		</center>
		 
		<script type="text/javascript">
			//connection with socket
			
			var socket = io.connect();
			
			function newPlayer(object)
			{
				socket.emit("new player", object);
			}
			
			//send info to server
			function sendInfoToServer(object)
			{
				socket.emit('update', object);
				socket.on('update', function(listObject){
					cellList = listObject;//security leak here but who care for now... lol
				});
			}
			
			//canvas game
		
			var canvas = document.getElementById("canvas");
			var ctx = canvas.getContext("2d");
			
			var foodNumber = 10;
			
			function drawCells(object)
			{
				ctx.beginPath();
				ctx.arc(object.x, object.y, object.radius, 0, 2*Math.PI);
				ctx.fillStyle = object.color;
				ctx.fill();
				ctx.stroke();
			}

			function cells(size) 
			{
				this.x = canvas.width/2;
				this.y = canvas.width/2;
				this.radius = size;
				this.color = "purple";
				this.speed = 2;
			}

			//player cells
			var cellList;
			var myCell = new cells(30);
			newPlayer(myCell); //send new player info to server
			
			//local value for camera
			xCamera = 0;
			yCamera = 0;
				
			//update function
			var update = setInterval(function(){
				
				ctx.clearRect(0,0,canvas.width, canvas.height);//make sure you draw everything after this line
				sendInfoToServer(myCell);//sending our position to the server
				for (x = 0; x < cellList.length; x++) //to have a fixed camera I move other player
				{
					xCamera -= movementX*myCell.speed;
					yCamera -= movementY*myCell.speed;
					if(socket.id != cellList[x].id)
					{
					cellList[x].cell.x += xCamera;
					cellList[x].cell.y += yCamera;
					drawCells(cellList[x].cell);
					}
				}
				drawCells(myCell);
			},16);//60frame per second

			var movementY = 0;
			var movementX = 0;

			//mouse position detection
			function mousePosition(e) {
				 var rect = canvas.getBoundingClientRect();
				 var mouseX = e.clientX - rect.left;
				 var mouseY = e.clientY - rect.top;
				 if(mouseX < canvas.width && mouseX > 0 && mouseY < canvas.height && mouseY > 0)
				 {	 
				 movementX = (mouseX-250)/canvas.width;
				 movementY = (mouseY-250)/canvas.height;
				 }
			}
		</script>
		
	</body>
</html>