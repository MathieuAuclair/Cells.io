<!DOCTYPE html>
<html onmousemove="mousePosition(event)">
	<head>
		<title>Cells.io</title>
		<meta charset="utf-8"/>
		<script src="/socket.io/socket.io.js"></script>
	</head>
	<body>
		<center>
			<canvas style="border:1px solid black;" width="500" height="500" id="canvas"></canvas>
		</center>
		 
		<script type="text/javascript">
			//connection with socket
			
			var socket = io.connect();
			
			function newPlayer(object)
			{
				socket.emit("new player", object);
			}
			
			//send info to server
			function sendInfoToServer(object)
			{
				socket.emit('update', object);
				socket.on('update', function(objectList){
					console.log("================================");
					console.log("original recived : " + objectList);
					console.log("parse : " + JSON.parse(objectList));
					cellList = objectList;//security leak here but who care for now... lol
					console.log("result cellList : " + cellList);
				});
			}
			
			//canvas game
		
			var canvas = document.getElementById("canvas");
			var ctx = canvas.getContext("2d");
			
			function drawCells(object)
			{
				ctx.beginPath();
				ctx.arc(object.x, object.y, object.radius, 0, 2*Math.PI);
				ctx.fillStyle = object.color;
				ctx.fill();
				ctx.stroke();
			}

			function cells(size) 
			{
				this.x = canvas.width/2;
				this.y = canvas.width/2;
				this.radius = size;
				this.color = "blue";
				this.speed = 0.1;
			}

			//player cells
			var cellList = [];
			var myCell = new cells(30);
			newPlayer(myCell); //send new player info to server
			
			//local value for camera
			xCamera = 0;
			yCamera = 0;
				
			//update function
			var update = setInterval(function(){
				
				ctx.clearRect(0,0,canvas.width, canvas.height);//make sure you draw everything after this line
				/*sendInfoToServer(myCell);//sending our position to the server
				for (x = 0; x < JSON.parse(cellList).length; x++) //to have a fixed camera I move other player
				{
					xCamera -= movementX*myCell.speed;
					yCamera -= movementY*myCell.speed;
					//to pass over JSON.parse, I use a dummy variable to draw object in the array
					if(socket.id != JSON.parse(cellList[x]).socketId)
					{
					var cellToDraw = JSON.parse(cellList[x]).cell;
					cellToDraw.x += xCamera;//doesn't matter what i do with these, because i just send myCell to server
					cellToDraw.y += yCamera;//
					}
				drawCells(cellToDraw);
				}*/
			},16);//60frame per second

			var movementY = 0;
			var movementX = 0;

			//mouse position detection
			function mousePosition(e) {
				 var rect = canvas.getBoundingClientRect();
				 var mouseX = e.clientX - rect.left;
				 var mouseY = e.clientY - rect.top;
				 if(mouseX < canvas.width && mouseX > 0 && mouseY < canvas.height && mouseY > 0)
				 {	 
				 movementX = (mouseX-250)/canvas.width;
				 movementY = (mouseY-250)/canvas.height;
				 }
			}
		</script>
		
	</body>
</html>