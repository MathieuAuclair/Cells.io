<!DOCTYPE html>
<html onmousemove="mousePosition(event)">
	<head>
		<title>Cells.io</title>
		<meta charset="utf-8"/>
		<script src="/socket.io/socket.io.js"></script>
	</head>
	<body>
		<center>
			<canvas style="border:1px solid black;" width="500" height="500" id="canvas"></canvas>
		</center>
		 
		<script type="text/javascript">
			//connection with socket
			
			var socket = io.connect();
			
			function newPlayer(object)
			{
				socket.emit("new player", object);
			}
			
			//send info to server
			function sendInfoToServer(object)
			{
				socket.emit('update', object);
				socket.on('update', function(listObject){
					// need to draw object in the list
				});
			}
			
			//canvas game
		
			var canvas = document.getElementById("canvas");
			var ctx = canvas.getContext("2d");

			var foodNumber = 10;

			function drawCells(object)
			{
				ctx.beginPath();
				ctx.arc(object.x, object.y, object.radius, 0, 2*Math.PI);
				ctx.fillStyle = object.color;
				ctx.fill();
				ctx.stroke();
			}

			function cells(size) 
			{
				this.x = canvas.width/2;
				this.y = canvas.width/2;
				this.radius = size;
				this.color = "purple";
				this.speed = 0;
			}

			//player cells
			var myCell = new cells(30);
			myCell.speed = 8; //giving speed to player since it's the only cell to move
			
			newPlayer(myCell); //send info to server
			//food cells
			var foodCells = [];
			//init value for food cells
			for (x = 0; x < foodNumber; x++)
				{
					respawnFood(x);
				}

			function respawnFood(x)
			{
					foodCells[x] = new cells(10);
					foodCells[x].x = Math.round(Math.random()*canvas.width);
					foodCells[x].y = Math.round(Math.random()*canvas.height);
					foodCells[x].color = "purple";
			}
				
			//update function
			var update = setInterval(function(){
				
				ctx.clearRect(0,0,canvas.width, canvas.height);//make sure you draw everything after this line
				
				for (x = 0; x < foodNumber; x++) //to have a fixed camera i move food
				{
					foodCells[x].x -= movementX*myCell.speed;
					foodCells[x].y -= movementY*myCell.speed;
					if(Math.abs(myCell.x-foodCells[x].x)<myCell.radius && Math.abs(myCell.y-foodCells[x].y)<myCell.radius)
					{
						respawnFood(x);
						myCell.radius += 1;
						myCell.speed = myCell.speed * 0.99;
						
					}
					drawCells(foodCells[x]);
				}
				sendInfoToServer(myCell);//sending our position to the server
			},16);//60frame per second

			var movementY = 0;
			var movementX = 0;

			//mouse position detection
			function mousePosition(e) {
				 var rect = canvas.getBoundingClientRect();
				 var mouseX = e.clientX - rect.left;
				 var mouseY = e.clientY - rect.top;
				 if(mouseX < canvas.width && mouseX > 0 && mouseY < canvas.height && mouseY > 0)
				 {	 
				 movementX = (mouseX-250)/canvas.width;
				 movementY = (mouseY-250)/canvas.height;
				 }
			}
		</script>
		
	</body>
</html>